# Domain

## –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–ü–∞–ø–∫–∞ `domain` —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–±—â–∏–µ –¥–æ–º–µ–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ñ–∏—á–∞–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –≠—Ç–∏ –∫–ª–∞—Å—Å—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç —á–∏—Å—Ç—É—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Å–ª–æ–µ–≤.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞
**domain/** - üèõÔ∏è –î–æ–º–µ–Ω–Ω—ã–π —Å–ª–æ–π  
-  entity.dart - üéØ –ë–∞–∑–æ–≤—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

## –û–ø–∏—Å–∞–Ω–∏–µ

### entity.dart
–ë–∞–∑–æ–≤—ã–µ –¥–æ–º–µ–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏. –°–æ–¥–µ—Ä–∂–∏—Ç:
- –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–µ –∫–ª–∞—Å—Å—ã –¥–ª—è –≤—Å–µ—Ö –æ–±—â–∏—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π
- –ë–∞–∑–æ–≤—ã–µ value objects –∏ entities
- –û–±—â–∏–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è –æ–±—â–∏—Ö –¥–æ–º–µ–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### Entity
–ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å –¥–ª—è –≤—Å–µ—Ö –æ–±—â–∏—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏–π:
- –ë–∞–∑–æ–≤—ã–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –∏ —Å–≤–æ–π—Å—Ç–≤–∞
- –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –∏ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã
- –ú–µ—Ç–æ–¥—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –∏ —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞
- –í–∞–ª–∏–¥–∞—Ü–∏—é –¥–æ–º–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤

### ValueObject
–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è value objects:
- Immutable –æ–±—ä–µ–∫—Ç—ã –±–µ–∑ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞
- –ë–∏–∑–Ω–µ—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
- –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–≤–µ–Ω—Å—Ç–≤–æ –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é
- –î–æ–º–µ–Ω–Ω–æ-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è –ª–æ–≥–∏–∫–∞

### DomainService
–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –æ–±—â–∏—Ö –¥–æ–º–µ–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:
- –û–ø–µ—Ä–∞—Ü–∏–∏, –Ω–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—â–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç–∏
- –°–ª–æ–∂–Ω–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ spanning multiple entities
- Stateless —Å–µ—Ä–≤–∏—Å—ã —Å —á–∏—Å—Ç–æ–π –ª–æ–≥–∏–∫–æ–π

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- **–ß–∏—Å—Ç–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞** - –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Å–ª–æ–µ–≤
- **–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å** - –µ–¥–∏–Ω—ã–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –º–µ–∂–¥—É —Ñ–∏—á–∞–º–∏
- **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ—Å—Ç—å** - –æ–±—â–∏–µ —Å—É—â–Ω–æ—Å—Ç–∏ –¥–ª—è –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã
- **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ–µ unit-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å** - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –¥–æ–º–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞

## Best Practices

1. –î–µ–ª–∞–π—Ç–µ –≤—Å–µ —Å—É—â–Ω–æ—Å—Ç–∏ immutable –≥–¥–µ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ
2. –ò–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É–π—Ç–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –≤–Ω—É—Ç—Ä–∏ —Å—É—â–Ω–æ—Å—Ç–µ–π
3. –í–∞–ª–∏–¥–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –¥–æ–º–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ value objects –¥–ª—è –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤ —Å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π
5. –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –∏ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã
6. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –¥–æ–º–µ–Ω–Ω—É—é –ª–æ–≥–∏–∫—É –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ
7. –ò–∑–±–µ–≥–∞–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Å–ª–æ–µ–≤

## –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```dart
// –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å —Å—É—â–Ω–æ—Å—Ç–∏
abstract class Entity<T> {
  final T id;

  const Entity(this.id);

  @override
  bool operator ==(Object other) =>
      identical(this, other) ||
      other is Entity<T> &&
          runtimeType == other.runtimeType &&
          id == other.id;

  @override
  int get hashCode => id.hashCode;
}

// –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å value object
abstract class ValueObject<T> {
  final T value;

  const ValueObject(this.value) {
    _validate(value);
  }

  void _validate(T value);

  @override
  bool operator ==(Object other) =>
      identical(this, other) ||
      other is ValueObject<T> &&
          runtimeType == other.runtimeType &&
          value == other.value;

  @override
  int get hashCode => value.hashCode;

  @override
  String toString() => 'ValueObject($value)';
}

// –û–±—â–∞—è —Å—É—â–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –≤—Å–µ—Ö —Ñ–∏—á
class User extends Entity<String> {
  final UserName name;
  final Email email;
  final UserRole role;
  final DateTime createdAt;
  final DateTime updatedAt;

  const User({
    required String id,
    required this.name,
    required this.email,
    required this.role,
    required this.createdAt,
    required this.updatedAt,
  }) : super(id);

  User copyWith({
    UserName? name,
    Email? email,
    UserRole? role,
  }) {
    return User(
      id: id,
      name: name ?? this.name,
      email: email ?? this.email,
      role: role ?? this.role,
      createdAt: createdAt,
      updatedAt: DateTime.now(),
    );
  }

  bool get isAdmin => role == UserRole.admin;
  bool get isModerator => role == UserRole.moderator;
  
  // –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞
  bool canManageUsers(User currentUser) {
    return currentUser.isAdmin || 
           (currentUser.isModerator && role != UserRole.admin);
  }
}

// Value object –¥–ª—è email
class Email extends ValueObject<String> {
  static final _emailRegex = RegExp(
    r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'
  );

  const Email(super.value);

  @override
  void _validate(String value) {
    if (!_emailRegex.hasMatch(value)) {
      throw InvalidEmailException(value);
    }
  }
}

// Value object –¥–ª—è –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
class UserName extends ValueObject<String> {
  const UserName(super.value);

  @override
  void _validate(String value) {
    if (value.isEmpty) {
      throw InvalidUserNameException('Username cannot be empty');
    }
    if (value.length < 2) {
      throw InvalidUserNameException('Username must be at least 2 characters');
    }
    if (value.length > 50) {
      throw InvalidUserNameException('Username cannot exceed 50 characters');
    }
  }
}

// –î–æ–º–µ–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
class InvalidEmailException implements Exception {
  final String email;

  const InvalidEmailException(this.email);

  @override
  String toString() => 'InvalidEmailException: $email is not a valid email';
}

class InvalidUserNameException implements Exception {
  final String message;

  const InvalidUserNameException(this.message);

  @override
  String toString() => 'InvalidUserNameException: $message';
}

// Enum —Ä–æ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
enum UserRole {
  user,
  moderator,
  admin,
}